{% macro pagination(numPages, currentPage, searchParams) %}
    {# Optional search parameter #}
    {% set searchQuery = '' %}
    {% if searchParams is defined and searchParams %}
        {% set searchQuery = '?' ~ searchParams|url_encode ~ '&page=' %}
    {% else %}
        {% set searchQuery = '?page=' %}
    {% endif %}

    {% set currentPage = currentPage ?? 1 %}

    {% if numPages > 1 %}
        <nav class="mt-4" aria-label="Page navigation">
            <ul class="pagination justify-content-center">

                {# Previous page — only show if not on the first page #}
                {% if currentPage > 1 %}
                    <li class="page-item">
                        <a class="page-link" href="{{ searchQuery }}{{ currentPage - 1 }}" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                {% endif %}

                {# Page rendering logic #}
                {% if numPages <= 10 %}
                    {# Show all pages when there are few #}
                    {% for i in 1..numPages %}
                        <li class="page-item {{ currentPage == i ? 'active' }}">
                            <a class="page-link" href="{{ searchQuery }}{{ i }}">{{ i }}</a>
                        </li>
                    {% endfor %}
                {% else %}
                    {# --- Case 1: beginning --- #}
                    {% if currentPage <= 4 %}
                        {% for i in 1..5 %}
                            <li class="page-item {{ currentPage == i ? 'active' }}">
                                <a class="page-link" href="{{ searchQuery }}{{ i }}">{{ i }}</a>
                            </li>
                        {% endfor %}
                        {% if 6 < numPages - 1 %}
                            <li class="page-item disabled"><span class="page-link">…</span></li>
                        {% endif %}
                        <li class="page-item"><a class="page-link" href="{{ searchQuery }}{{ numPages }}">{{ numPages }}</a></li>

                    {# --- Case 2: end --- #}
                    {% elseif currentPage >= (numPages - 3) %}
                        <li class="page-item"><a class="page-link" href="{{ searchQuery }}1">1</a></li>
                        {% if numPages - 5 > 2 %}
                            <li class="page-item disabled"><span class="page-link">…</span></li>
                        {% endif %}
                        {% for i in (numPages - 4)..numPages %}
                            <li class="page-item {{ currentPage == i ? 'active' }}">
                                <a class="page-link" href="{{ searchQuery }}{{ i }}">{{ i }}</a>
                            </li>
                        {% endfor %}

                    {# --- Case 3: middle (between the “...”) --- #}
                    {% else %}
                        {# Define dynamic range #}
                        {% set startPage = currentPage - 3 %}
                        {% set endPage = currentPage + 6 %}

                        {# Adjust limits #}
                        {% if startPage < 2 %}
                            {% set startPage = 2 %}
                        {% endif %}
                        {% if endPage > numPages - 1 %}
                            {% set endPage = numPages - 1 %}
                        {% endif %}

                        {# First page #}
                        <li class="page-item"><a class="page-link" href="{{ searchQuery }}1">1</a></li>

                        {# Show “…” only if there is a gap greater than 1 #}
                        {% if startPage > 2 %}
                            <li class="page-item disabled"><span class="page-link">…</span></li>
                        {% endif %}

                        {# Middle pages (3 before, 6 after) #}
                        {% for i in startPage..endPage %}
                            <li class="page-item {{ currentPage == i ? 'active' }}">
                                <a class="page-link" href="{{ searchQuery }}{{ i }}">{{ i }}</a>
                            </li>
                        {% endfor %}

                        {# Show “…” only if there is a gap greater than 1 before the end #}
                        {% if endPage < numPages - 1 %}
                            <li class="page-item disabled"><span class="page-link">…</span></li>
                        {% endif %}

                        {# Last page #}
                        <li class="page-item"><a class="page-link" href="{{ searchQuery }}{{ numPages }}">{{ numPages }}</a></li>
                    {% endif %}
                {% endif %}

                {# Next page — only show if not on the last page #}
                {% if currentPage < numPages %}
                    <li class="page-item">
                        <a class="page-link" href="{{ searchQuery }}{{ currentPage + 1 }}" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                {% endif %}

            </ul>
        </nav>
    {% endif %}
{% endmacro %}

{{ _self.pagination(numPages, currentPage) }}
